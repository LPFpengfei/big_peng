<%# 管理端图书表单页面 %> 
<%= form_for([:admin, @book], html: { class: "space-y-4" }) do |f| %>
  <!-- 标题 -->
  <div class="form-group">
    <%= f.label :title, "标题", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.text_field :title, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    <%= f.error_message_on :title, class: "text-red-500 text-sm mt-1" %>
  </div>

  <!-- 作者 -->
  <div class="form-group">
    <%= f.label :author, "作者", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.text_field :author, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    <%= f.error_message_on :author, class: "text-red-500 text-sm mt-1" %>
  </div>

  <!-- 分类 -->
  <div class="form-group">
    <%= f.label :category_id, "分类", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.collection_select :category_id, Category.all, :id, :name, { include_blank: "未分类" }, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    <%= f.error_message_on :category_id, class: "text-red-500 text-sm mt-1" %>
  </div>

  <!-- 描述 -->
  <div class="form-group">
    <%= f.label :description, "描述", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.text_area :description, rows: 4, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    <%= f.error_message_on :description, class: "text-red-500 text-sm mt-1" %>
  </div>

  <!-- 封面图片 -->
  <div class="form-group">
    <%= f.label :cover_image, "封面图片URL", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.text_field :cover_image, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    <%= f.error_message_on :cover_image, class: "text-red-500 text-sm mt-1" %>
  </div>

  <!-- 文件路径 -->
  <div class="form-group">
    <%= f.label :file_path, "文件路径", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.text_field :file_path, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    <%= f.error_message_on :file_path, class: "text-red-500 text-sm mt-1" %>
  </div>

  <!-- 来源 -->
  <div class="form-group">
    <%= f.label :source, "来源", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.text_field :source, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    <%= f.error_message_on :source, class: "text-red-500 text-sm mt-1" %>
  </div>

  <!-- 提交按钮 -->
  <div class="form-group flex justify-end">
    <button type="button" id="cancel-btn" class="mr-2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">
      取消
    </button>
    <%= f.submit class: "bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded" %>
  </div>
<% end %>

<script>
  // 取消按钮点击事件
  document.getElementById('cancel-btn').addEventListener('click', function() {
    document.getElementById('book-modal').classList.add('hidden');
  });

  // 表单提交处理
  document.querySelector('form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const form = this;
    const formData = new FormData(form);
    
    fetch(form.action, {
      method: form.method,
      headers: {
        'Accept': 'application/json',
        'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
      },
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // 关闭模态框
        document.getElementById('book-modal').classList.add('hidden');
        // 刷新页面
        window.location.reload();
      } else {
        // 显示错误信息
        alert('操作失败: ' + data.errors.join(', '));
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('操作失败，请重试');
    });
  });
</script>