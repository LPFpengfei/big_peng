# 电子书软件实现计划

## 一、项目架构

### 1. 后端（Rails）
- **API架构**：RESTful API + JSON格式
- **数据库**：PostgreSQL
- **主要功能**：
  - 电子书管理（上传、编辑、删除、分类）
  - 爬虫功能（拉取网站电子书）
  - 用户认证与授权
  - 书架管理
  - 书签管理
  - 阅读进度管理

### 2. 前端（鸿蒙App）
- **架构**：HarmonyOS ArkTS
- **主要功能**：
  - 用户登录/注册
  - 书架展示与管理
  - 电子书阅读器
  - 书签功能
  - 阅读进度同步
  - 电子书分类浏览

## 二、后端实现计划

### 1. 模型设计

| 模型名 | 主要字段 | 关系 |
|--------|----------|------|
| User | email, password_digest, nickname | has_many :bookshelves, :bookmarks, :reading_progresses |
| Book | title, author, description, cover_image, file_path, category, source | has_many :bookmarks, :reading_progresses |
| Bookshelf | user_id, book_id | belongs_to :user, :book |
| Bookmark | user_id, book_id, chapter, page, note | belongs_to :user, :book |
| ReadingProgress | user_id, book_id, chapter, page, updated_at | belongs_to :user, :book |
| Category | name, description | has_many :books |

### 2. 控制器设计

| 控制器 | 主要动作 |
|--------|----------|
| Api::V1::AuthController | login, register, logout |
| Api::V1::BooksController | index, show, create, update, destroy |
| Api::V1::BookshelvesController | index, create, destroy |
| Api::V1::BookmarksController | index, create, update, destroy |
| Api::V1::ReadingProgressesController | show, update |
| Api::V1::CategoriesController | index, show |
| Admin::BooksController | index, new, create, edit, update, destroy |
| Admin::CrawlersController | index, create, destroy |

### 3. API设计

| 端点 | 方法 | 功能 |
|------|------|------|
| /api/v1/auth/login | POST | 用户登录 |
| /api/v1/auth/register | POST | 用户注册 |
| /api/v1/books | GET | 获取电子书列表 |
| /api/v1/books/:id | GET | 获取电子书详情 |
| /api/v1/bookshelves | GET | 获取用户书架 |
| /api/v1/bookshelves | POST | 添加到书架 |
| /api/v1/bookshelves/:id | DELETE | 从书架移除 |
| /api/v1/bookmarks | GET | 获取用户书签 |
| /api/v1/bookmarks | POST | 添加书签 |
| /api/v1/bookmarks/:id | PUT | 更新书签 |
| /api/v1/bookmarks/:id | DELETE | 删除书签 |
| /api/v1/reading_progresses/:book_id | GET | 获取阅读进度 |
| /api/v1/reading_progresses/:book_id | PUT | 更新阅读进度 |

### 4. 主要功能实现

#### （1）用户认证
- 使用JWT token进行认证
- 实现登录、注册、登出功能

#### （2）电子书管理
- 支持多种格式上传（epub、mobi、pdf等）
- 实现电子书元数据提取
- 支持分类管理

#### （3）爬虫功能
- 实现定时任务拉取指定网站的电子书
- 支持配置不同网站的爬虫规则
- 自动提取电子书元数据

#### （4）书架管理
- 支持添加/移除电子书到书架
- 支持书架分类

#### （5）书签管理
- 支持在阅读时添加/编辑/删除书签
- 支持按电子书查看书签

#### （6）阅读进度管理
- 自动保存阅读进度
- 支持多设备同步

## 三、前端实现计划

### 1. 页面设计

| 页面 | 主要功能 |
|------|----------|
| 登录页 | 用户登录/注册 |
| 书架页 | 展示已添加的电子书，支持分类查看 |
| 阅读器页 | 电子书阅读、书签管理、阅读进度控制 |
| 发现页 | 浏览新书、热门书籍、分类书籍 |
| 个人中心页 | 用户信息管理、设置 |

### 2. 核心组件

| 组件 | 功能 |
|------|------|
| LoginComponent | 登录表单 |
| RegisterComponent | 注册表单 |
| BookshelfComponent | 书架展示 |
| BookReaderComponent | 电子书阅读器 |
| BookmarkComponent | 书签管理 |
| CategoryListComponent | 分类列表 |

### 3. 数据交互

- 使用HTTP请求与后端API交互
- 实现本地缓存机制，提高离线使用体验
- 支持数据同步机制

## 四、实现步骤

### 1. 后端实现

1. **基础设置**
   - 配置CORS
   - 安装JWT相关gem
   - 配置API版本控制

2. **模型实现**
   - 创建User模型
   - 创建Book模型
   - 创建Bookshelf模型
   - 创建Bookmark模型
   - 创建ReadingProgress模型
   - 创建Category模型

3. **API实现**
   - 实现认证相关API
   - 实现电子书相关API
   - 实现书架相关API
   - 实现书签相关API
   - 实现阅读进度相关API
   - 实现分类相关API

4. **管理功能**
   - 实现管理员电子书管理界面
   - 实现爬虫管理功能

5. **爬虫功能**
   - 实现基础爬虫框架
   - 配置目标网站爬虫规则
   - 实现定时任务

### 2. 前端实现

1. **项目初始化**
   - 创建HarmonyOS项目
   - 配置网络请求
   - 配置状态管理

2. **页面实现**
   - 实现登录/注册页面
   - 实现书架页面
   - 实现阅读器页面
   - 实现发现页面
   - 实现个人中心页面

3. **功能实现**
   - 实现用户认证
   - 实现书架管理
   - 实现阅读器功能
   - 实现书签功能
   - 实现阅读进度同步

## 五、技术栈

### 后端
- Ruby on Rails 8.0
- PostgreSQL
- JWT (jsonwebtoken gem)
- Pundit (权限管理)
- Nokogiri (HTML解析)
- Mechanize (网页爬虫)
- Sidekiq (后台任务)

### 前端
- HarmonyOS ArkTS
- HTTP DataAbility
- Preferences (本地存储)
- SQLite (本地数据库)

## 六、注意事项

1. **性能优化**
   - 电子书文件存储考虑使用对象存储服务
   - API实现分页和缓存机制
   - 前端实现本地缓存

2. **安全性**
   - 实现API权限控制
   - 电子书文件上传安全检查
   - 防止SQL注入和XSS攻击

3. **可扩展性**
   - 设计模块化的API架构
   - 支持多种电子书格式
   - 支持多平台扩展

4. **用户体验**
   - 实现流畅的阅读体验
   - 支持离线阅读
   - 实现数据同步机制

## 七、后续迭代方向

1. 添加电子书搜索功能
2. 实现阅读统计与推荐
3. 添加社交功能（分享、评论）
4. 支持听书功能
5. 实现更多电子书格式支持
6. 添加夜间模式等阅读设置